"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[5926],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>f});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),p=u(n),m=r,f=p["".concat(s,".").concat(m)]||p[m]||d[m]||o;return n?a.createElement(f,l(l({ref:t},c),{},{components:n})):a.createElement(f,l({ref:t},c))}));function f(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,l=new Array(o);l[0]=m;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[p]="string"==typeof e?e:r,l[1]=i;for(var u=2;u<o;u++)l[u]=n[u];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},9532:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>u});var a=n(7462),r=(n(7294),n(3905));const o={},l="Snowflake CDC Connector",i={unversionedId:"reference/Connectors/capture-connectors/snowflake",id:"reference/Connectors/capture-connectors/snowflake",title:"Snowflake CDC Connector",description:"This connector captures change events from source tables in a Snowflake database.",source:"@site/docs/reference/Connectors/capture-connectors/snowflake.md",sourceDirName:"reference/Connectors/capture-connectors",slug:"/reference/Connectors/capture-connectors/snowflake",permalink:"/reference/Connectors/capture-connectors/snowflake",draft:!1,editUrl:"https://github.com/estuary/flow/edit/master/site/docs/reference/Connectors/capture-connectors/snowflake.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Snapchat Marketing",permalink:"/reference/Connectors/capture-connectors/snapchat"},next:{title:"Stripe",permalink:"/reference/Connectors/capture-connectors/stripe"}},s={},u=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Setup",id:"setup",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Endpoint Properties",id:"endpoint-properties",level:3},{value:"Binding Properties",id:"binding-properties",level:3},{value:"Polling Interval",id:"polling-interval",level:3},{value:"Sample Configuration",id:"sample-configuration",level:3}],c={toc:u},p="wrapper";function d(e){let{components:t,...n}=e;return(0,r.kt)(p,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"snowflake-cdc-connector"},"Snowflake CDC Connector"),(0,r.kt)("p",null,"This connector captures change events from source tables in a Snowflake database."),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("p",null,"To use this connector, you'll need:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"A Snowflake account that includes:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"A target database containing the tables you want to capture from."),(0,r.kt)("li",{parentName:"ul"},"A ",(0,r.kt)("a",{parentName:"li",href:"https://docs.snowflake.com/en/user-guide/warehouses"},"virtual warehouse")," which the connector can use to execute queries."),(0,r.kt)("li",{parentName:"ul"},"A ",(0,r.kt)("a",{parentName:"li",href:"https://docs.snowflake.com/en/sql-reference/ddl-database.html"},"schema")," which will hold ",(0,r.kt)("a",{parentName:"li",href:"https://docs.snowflake.com/en/user-guide/streams-intro"},"streams")," and staging tables managed by the connector. The default name for this schema is ",(0,r.kt)("inlineCode",{parentName:"li"},"ESTUARY_STAGING")," unless overridden in the capture's advanced configuration."),(0,r.kt)("li",{parentName:"ul"},"A user with access grants for these resources, as well as authorization to read from the desired source tables, and to create streams and transient tables in the staging schema based on the source tables."))),(0,r.kt)("li",{parentName:"ul"},"The host URL for your Snowflake account. This is formatted using your ",(0,r.kt)("a",{parentName:"li",href:"https://docs.snowflake.com/en/user-guide/admin-account-identifier.html#where-are-account-identifiers-used"},"Snowflake account identifier"),", and might look something like ",(0,r.kt)("inlineCode",{parentName:"li"},"sg31386.snowflakecomputing.com")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"df98701.us-central1.gcp.snowflakecomputing.com"),".")),(0,r.kt)("p",null,"See the ",(0,r.kt)("a",{parentName:"p",href:"#setup"},"script below")," for details."),(0,r.kt)("h2",{id:"setup"},"Setup"),(0,r.kt)("p",null,"To set up a user account and warehouse for use with the Snowflake CDC connector,\ncopy and paste the following script into the Snowflake SQL editor. Modify the\nvariable declarations in the first few lines to set the password and optionally\ncustomize the names involved."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"set database_name = 'SOURCE_DB';         -- The database to capture from\nset warehouse_name = 'ESTUARY_WH';       -- The warehouse to execute queries in\nset estuary_user = 'ESTUARY_USER';       -- The name of the capture user\nset estuary_password = 'secret';         -- The password of the capture user\nset estuary_role = 'ESTUARY_ROLE';       -- A role for the capture user's permissions\n\n-- Create a role and user for Estuary\ncreate role if not exists identifier($estuary_role);\ngrant role identifier($estuary_role) to role SYSADMIN;\ncreate user if not exists identifier($estuary_user)\n  password = $estuary_password\n  default_role = $estuary_role\n  default_warehouse = $warehouse_name;\ngrant role identifier($estuary_role) to user identifier($estuary_user);\n\n-- Create a warehouse for Estuary and grant access to it\ncreate warehouse if not exists identifier($warehouse_name)\n  warehouse_size = xsmall\n  warehouse_type = standard\n  auto_suspend = 60\n  auto_resume = true\n  initially_suspended = true;\ngrant USAGE\n  on warehouse identifier($warehouse_name)\n  to role identifier($estuary_role);\n\n-- Grant Estuary access to read from all tables in the database and to create a staging schema\ngrant CREATE SCHEMA, MONITOR, USAGE\n  on database identifier($database_name)\n  to role identifier($estuary_role);\ngrant USAGE\n  on future schemas in database identifier($database_name)\n  to role identifier($estuary_role);\ngrant USAGE\n  on all schemas in database identifier($database_name)\n  to role identifier($estuary_role);\ngrant SELECT\n  on future tables in database identifier($database_name)\n  to role identifier($estuary_role);\ngrant SELECT\n  on all tables in database identifier($database_name)\n  to role identifier($estuary_role);\n\ncommit;\n")),(0,r.kt)("p",null,'Be sure to run the entire script with the "Run All" option.'),(0,r.kt)("h2",{id:"configuration"},"Configuration"),(0,r.kt)("p",null,"You can configure connectors either in the Flow web app, or by directly editing the catalog specification file. See ",(0,r.kt)("a",{parentName:"p",href:"https://docs.estuary.dev/concepts/connectors/#using-connectors"},"connectors")," to learn more about using connectors. The values and specification sample below provide configuration details specific to the Snowflake CDC source connector."),(0,r.kt)("h3",{id:"endpoint-properties"},"Endpoint Properties"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Property"),(0,r.kt)("th",{parentName:"tr",align:null},"Title"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Required/Default"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},(0,r.kt)("inlineCode",{parentName:"strong"},"/host"))),(0,r.kt)("td",{parentName:"tr",align:null},"Host URL"),(0,r.kt)("td",{parentName:"tr",align:null},"The Snowflake Host used for the connection. Example: orgname-accountname.snowflakecomputing.com (do not include the protocol)."),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Required")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},(0,r.kt)("inlineCode",{parentName:"strong"},"/account"))),(0,r.kt)("td",{parentName:"tr",align:null},"Account"),(0,r.kt)("td",{parentName:"tr",align:null},"The Snowflake account identifier"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Required")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},(0,r.kt)("inlineCode",{parentName:"strong"},"/database"))),(0,r.kt)("td",{parentName:"tr",align:null},"Database"),(0,r.kt)("td",{parentName:"tr",align:null},"The name of the Snowflake database to capture from"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Required")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},(0,r.kt)("inlineCode",{parentName:"strong"},"/user"))),(0,r.kt)("td",{parentName:"tr",align:null},"User"),(0,r.kt)("td",{parentName:"tr",align:null},"The Snowflake user login name"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Required")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},(0,r.kt)("inlineCode",{parentName:"strong"},"/password"))),(0,r.kt)("td",{parentName:"tr",align:null},"Password"),(0,r.kt)("td",{parentName:"tr",align:null},"The password for the specified login user"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Required")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"/warehouse")),(0,r.kt)("td",{parentName:"tr",align:null},"Warehouse"),(0,r.kt)("td",{parentName:"tr",align:null},"The Snowflake virtual warehouse used to execute queries. The default warehouse for the user will be used if this is blank."),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"/advanced")),(0,r.kt)("td",{parentName:"tr",align:null},"Advanced Options"),(0,r.kt)("td",{parentName:"tr",align:null},"Options for advanced users. You should not typically need to modify these."),(0,r.kt)("td",{parentName:"tr",align:null},"object"),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"/advanced/flowSchema")),(0,r.kt)("td",{parentName:"tr",align:null},"Flow Schema"),(0,r.kt)("td",{parentName:"tr",align:null},"The schema in which Flow will create and manage its streams and staging tables."),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"ESTUARY_STAGING")))),(0,r.kt)("h3",{id:"binding-properties"},"Binding Properties"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Property"),(0,r.kt)("th",{parentName:"tr",align:null},"Title"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Required/Default"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},(0,r.kt)("inlineCode",{parentName:"strong"},"/table"))),(0,r.kt)("td",{parentName:"tr",align:null},"Table"),(0,r.kt)("td",{parentName:"tr",align:null},"The name of the table to capture"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Required")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},(0,r.kt)("inlineCode",{parentName:"strong"},"/schema"))),(0,r.kt)("td",{parentName:"tr",align:null},"Schema"),(0,r.kt)("td",{parentName:"tr",align:null},"The schema in which the table resides"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Required")))),(0,r.kt)("h3",{id:"polling-interval"},"Polling Interval"),(0,r.kt)("p",null,'Keeping a Snowflake compute warehouse active 24/7 can be prohibitively expensive for many users,\nso the Snowflake CDC connector is designed to poll for changes at a configurable interval, at\nwhich time it will capture into Flow all new changes since the previous execution. This polling\ninterval is set to 5 minutes by default, in an attempt to strike a balance between cost savings\nwhile still providing "good enough" capture latency for most streaming uses. The interval may\nbe configured by editing the task spec ',(0,r.kt)("inlineCode",{parentName:"p"},"interval")," property ",(0,r.kt)("a",{parentName:"p",href:"https://docs.estuary.dev/concepts/captures/#specification"},"as described here"),"."),(0,r.kt)("p",null,"Specifying a smaller interval can provide even lower capture latencies but is likely to incur\nhigher costs for Snowflake warehouse usage. A higher interval will reduce Snowflake costs by\nallowing the warehouse to be idle for longer, in cases where it's okay for the captured data\nto lag the source dataset by a few hours. Note that regardless of the polling interval the\noutput collections will contain an accurate representation of the source tables up to some\nmoment in time, the interval merely controls how frequent and fine-grained the updates are."),(0,r.kt)("h3",{id:"sample-configuration"},"Sample Configuration"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"materializations:\n  ${prefix}/source-snowflake:\n    endpoint:\n      connector:\n        image: ghcr.io/estuary/source-snowflake:v1\n        config:\n          host: cf22902.us-central1.gcp.snowflakecomputing.com\n          account: cf22902\n          database: SOURCE_DB\n          user: ESTUARY_USER\n          password: secret\n    bindings:\n      - resource:\n          schema: ${schema_name}\n          table: ${table_name}\n        target: ${prefix}/collection_name\n    interval: 30m\n")))}d.isMDXComponent=!0}}]);